<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EstadÃ­sticas - Panificados</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- Archivo de estadÃ­sticas -->
  <script type="module" src="poo/estadisticas.js"></script>
</head>

<body>
  <header>
    <h1>EstadÃ­sticas de Ventas - Panificados</h1>
    <div class="header-actions">
      <button id="volverBtn">â† Volver</button>
      <button id="exportarCSVBtn">â¬‡ï¸ Exportar CSV</button>
      <button id="exportarPDFDiaBtn">ğŸ“„ Exportar PDF del DÃ­a</button>
      <button id="exportarPDFMesBtn">ğŸ—“ï¸ Exportar PDF del Mes</button>
      <button id="toggleThemeBtn">ğŸŒ™ Modo oscuro</button>
      <button id="resetEstadisticasBtn" class="danger">ğŸ—‘ Resetear estadÃ­sticas</button>
    </div>
  </header>

  <main>

    <!-- RESUMEN -->
    <section id="resumenSection">
      <h2>Resumen rÃ¡pido</h2>
      <div id="resumenTotales"></div>
    </section>

    <!-- CHARTS PRINCIPALES -->
    <section id="charts">
      <div class="chart-card">
        <h3>Top productos mÃ¡s vendidos</h3>
        <canvas id="chartTopProductos" height="200"></canvas>
      </div>

      <div class="chart-card">
        <h3>Ventas por categorÃ­a</h3>
        <canvas id="chartCategorias" height="200"></canvas>
      </div>

      <div class="chart-card">
        <h3>Ingresos reales vs venta esperada</h3>
        <canvas id="chartIngresos" height="200"></canvas>
      </div>

      <div class="chart-card">
        <h3>Promedio de unidades vendidas por producto</h3>
        <canvas id="chartPromedios" height="200"></canvas>
      </div>

      <div class="chart-card">
        <h3>Ganancia por turno (dÃ­a)</h3>
        <canvas id="chartDia" height="200"></canvas>
      </div>

      <div class="chart-card">
        <h3>Ingreso por dÃ­a (mes)</h3>
        <canvas id="chartVentasPorDia" height="200"></canvas>
      </div>

      <div class="chart-card">
        <h3>Ganancias por dÃ­a (mes)</h3>
        <canvas id="chartGananciasPorDia" height="200"></canvas>
      </div>
    </section>

    <!-- TABLA POR PRODUCTO -->
    <section id="tablaSection">
      <h3>Detalle por producto</h3>
      <table id="tablaProductos">
        <thead>
          <tr>
            <th>Producto</th>
            <th>CategorÃ­a</th>
            <th>Stock</th>
            <th>Vendidos</th>
            <th>Precio Venta</th>
            <th>Ganancia total</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- TABLA POR DÃA DEL MES -->
    <section id="tablaDiasSection">
      <h3>Resumen diario del mes</h3>
      <table id="tablaDias">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Ingreso</th>
            <th>Ganancia</th>
            <th>Costo vendido</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

  </main>

  <!-- PIE DE PÃGINA -->
  <footer>
    <p>&copy; 2025 - Cristian Daniel Altamiranda</p>
  </footer>

  <!-- ============================
        ğŸŒ™ TEMA OSCURO / CLARO 
       ============================ -->
  <script>
  document.addEventListener("DOMContentLoaded", () => {
      const btn = document.getElementById("toggleThemeBtn");

      document.body.style.transition =
        "background-color 0.35s ease, color 0.35s ease";

      function activarSegunHora() {
          const h = new Date().getHours();
          return (h >= 19 || h < 7);
      }

      let guardado = localStorage.getItem("darkMode");
      let usarDark = guardado === null ? activarSegunHora() : guardado === "true";

      if (usarDark) document.body.classList.add("dark");

      btn.textContent = usarDark ? "â˜€ï¸ Modo claro" : "ğŸŒ™ Modo oscuro";

      btn.addEventListener("click", () => {
          document.body.classList.toggle("dark");
          const dark = document.body.classList.contains("dark");
          localStorage.setItem("darkMode", dark);
          btn.textContent = dark ? "â˜€ï¸ Modo claro" : "ğŸŒ™ Modo oscuro";
      });
  });
  </script>

  <!-- ============================
        ğŸ¨ PALETA PARA CHART.JS 
       ============================ -->
  <script>
  window.chartThemes = {
      getColors() {
          const dark = document.body.classList.contains("dark");

          return {
              text: dark ? "#ffffff" : "#222222",
              grid: dark ? "rgba(255,255,255,0.18)" : "rgba(0,0,0,0.15)",
              border: dark ? "#dddddd" : "#444444",
              barColors: dark
                  ? ["#66ccff", "#ffcc66", "#99ff99", "#ff9999", "#cc99ff"]
                  : ["#3366cc", "#ff9933", "#33aa33", "#cc3333", "#9933cc"],
              donutColors: dark
                  ? ["#66ccff", "#99ff99", "#ffcc66", "#ff9999"]
                  : ["#3366cc", "#33aa33", "#ff9933", "#cc3333"]
          };
      },

      applyToChart(chart) {
          const C = this.getColors();

          chart.options.plugins.legend.labels.color = C.text;
          if (chart.options.plugins.title) {
              chart.options.plugins.title.color = C.text;
          }

          if (chart.options.scales) {
              Object.values(chart.options.scales).forEach(scale => {
                  scale.ticks.color = C.text;
                  scale.grid.color = C.grid;
                  scale.grid.borderColor = C.border;
              });
          }

          chart.update();
      },

      recolorAll() {
          if (!window.allCharts) return;
          window.allCharts.forEach((ch) => this.applyToChart(ch));
      }
  };

  document.addEventListener("DOMContentLoaded", () => {
      const observer = new MutationObserver(() => window.chartThemes.recolorAll());
      observer.observe(document.body, { attributes: true, attributeFilter: ["class"] });
  });
  </script>

  <!-- TU LÃ“GICA PRINCIPAL -->
  <script type="module" src="poo/estadisticas.js"></script>

</body>
</html>
